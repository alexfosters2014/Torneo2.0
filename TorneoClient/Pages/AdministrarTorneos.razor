@page "/administrar/torneos"
@inject DataServiceTorneo dataServiceTorneo

<h3>Administrar Torneos</h3>

<div class="containerAddJugador">


    <input type="text" @bind="nombreTorneo" class="buttonStyle" placeholder="Ingrese nombre del equipo">
    <button @onclick="BuscarTorneo" class="buttonStyle">Buscar</button>


    <table class="blueTable">
        <tr style="align-content:center">
            <td></td>
            <td>Nombre Torneo</td>
            <td>Desde</td>
            <td>Hasta</td>
            <td>Deporte</td>
            <td>Cantidad inscriptos</td>
            <td>Puntaje Max</td>
            <td>Sets Max</td>
            <td></td>
        </tr>
        <tr>

            @if (torneos != null || torneos.Count == 0)
            {
                <p>No hay torneos con el nombre especificado</p>
            }

            @if (torneos.Count > 0)
            {
                @foreach (var torneo in torneos)
                {
                    <td><img src="@ActualizarLinkImagen(torneo.ImagenRef)" alt="" class="imagenEnListada"></td>
                    <td>@torneo.Nombre</td>
                    <td>@torneo.Desde</td>
                    <td>@torneo.Hasta</td>
                    <td>@torneo.Deporte</td>
                    <td>@torneo.Inscripciones.Count</td>
                    <td>@torneo.PuntajeMax</td>
                    <td>@torneo.SetsMax</td>
                    <td><button class="buttonStyle" @onclick="() => AutomatizarFixture(torneo.Id)">Crear Fixture automático</button></td>
                }
            }

        </tr>
    </table>
</div>

@code {

    private string nombreTorneo = "";
    private List<Torneo> torneos = new();

    private async Task BuscarTorneo()
    {
        torneos = await dataServiceTorneo.GetTorneosVigentes(nombreTorneo);
        StateHasChanged();
    }

    private string ActualizarLinkImagen(string imagenRef)
    {
        return $"https://torneostorage.blob.core.windows.net/imagenesequipos/{imagenRef}";

    }

    private async Task AutomatizarFixture(int torneoId)
    {
        Torneo torneoFixture = torneos.SingleOrDefault(s => s.Id == torneoId);
        torneoFixture.Fixture = dataServiceTorneo.CrearFixtureAut(torneoFixture);
        //falta guardar el fixture en la base de datos

    }



}
